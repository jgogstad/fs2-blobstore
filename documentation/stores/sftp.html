<!DOCTYPE html><html><head><title>fs2-blobstore: SFTP</title><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="fs2-blobstore" /><meta name="description" content="Unified fs2 interface for various storage services" /><meta name="og:image" content="/fs2-blobstore/img/poster.png" /><meta name="image" property="og:image" content="/fs2-blobstore/img/poster.png" /><meta name="og:title" content="fs2-blobstore: SFTP" /><meta name="title" property="og:title" content="fs2-blobstore: SFTP" /><meta name="og:site_name" content="fs2-blobstore" /><meta name="og:url" content="https://github.com/fs2-blobstore/fs2-blobstore" /><meta name="og:type" content="website" /><meta name="og:description" content="Unified fs2 interface for various storage services" /><link rel="icon" type="image/png" href="/fs2-blobstore/img/favicon.png" /><meta name="twitter:title" content="fs2-blobstore: SFTP" /><meta name="twitter:image" content="/fs2-blobstore/img/poster.png" /><meta name="twitter:description" content="Unified fs2 interface for various storage services" /><meta name="twitter:card" content="summary_large_image" /><link rel="icon" type="image/png" sizes="16x16" href="/fs2-blobstore/img/favicon16x16.png" /><link rel="icon" type="image/png" sizes="24x24" href="/fs2-blobstore/img/favicon24x24.png" /><link rel="icon" type="image/png" sizes="32x32" href="/fs2-blobstore/img/favicon32x32.png" /><link rel="icon" type="image/png" sizes="48x48" href="/fs2-blobstore/img/favicon48x48.png" /><link rel="icon" type="image/png" sizes="57x57" href="/fs2-blobstore/img/favicon57x57.png" /><link rel="icon" type="image/png" sizes="60x60" href="/fs2-blobstore/img/favicon60x60.png" /><link rel="icon" type="image/png" sizes="64x64" href="/fs2-blobstore/img/favicon64x64.png" /><link rel="icon" type="image/png" sizes="70x70" href="/fs2-blobstore/img/favicon70x70.png" /><link rel="icon" type="image/png" sizes="72x72" href="/fs2-blobstore/img/favicon72x72.png" /><link rel="icon" type="image/png" sizes="76x76" href="/fs2-blobstore/img/favicon76x76.png" /><link rel="icon" type="image/png" sizes="96x96" href="/fs2-blobstore/img/favicon96x96.png" /><link rel="icon" type="image/png" sizes="114x114" href="/fs2-blobstore/img/favicon114x114.png" /><link rel="icon" type="image/png" sizes="120x120" href="/fs2-blobstore/img/favicon120x120.png" /><link rel="icon" type="image/png" sizes="128x128" href="/fs2-blobstore/img/favicon128x128.png" /><link rel="icon" type="image/png" sizes="144x144" href="/fs2-blobstore/img/favicon144x144.png" /><link rel="icon" type="image/png" sizes="150x150" href="/fs2-blobstore/img/favicon150x150.png" /><link rel="icon" type="image/png" sizes="152x152" href="/fs2-blobstore/img/favicon152x152.png" /><link rel="icon" type="image/png" sizes="196x196" href="/fs2-blobstore/img/favicon196x196.png" /><link rel="icon" type="image/png" sizes="310x310" href="/fs2-blobstore/img/favicon310x310.png" /><link rel="icon" type="image/png" sizes="310x150" href="/fs2-blobstore/img/favicon310x150.png" /><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" /><link rel="stylesheet" href="/fs2-blobstore/highlight/styles/vs.css" /><link rel="stylesheet" href="/fs2-blobstore/css/light-style.css" /></head><body class="docs"><div id="wrapper"><div id="sidebar-wrapper"><div id="sidebar-brand"><a href="/fs2-blobstore/" class="brand"><div class="brand-wrapper"></div><span>fs2-blobstore</span></a><button id="main-toggle" class="sidebar-toggle"><span class="close"></span></button></div><div class="sidebar-nav"> <div class="sidebar-nav-item  "><a href="/fs2-blobstore/documentation/data-model" title="Data model" class="">Data model</a></div> <div class="sidebar-nav-item  open"><a href="/fs2-blobstore/documentation/stores.html" title="Stores" class="drop-nested">Stores</a><i class="fa fa-angle-right"></i><div class="sub-section"> <a href="/fs2-blobstore/documentation/stores/gcs.html" title="GCS" class="">GCS</a> <a href="/fs2-blobstore/documentation/stores/s3.html" title="S3" class="">S3</a> <a href="/fs2-blobstore/documentation/stores/azure.html" title="Azure" class="">Azure</a> <a href="/fs2-blobstore/documentation/stores/sftp.html" title="SFTP" class="active">SFTP</a> <a href="/fs2-blobstore/documentation/stores/box.html" title="Box" class="">Box</a></div></div></div></div><div id="page-content-wrapper"><div class="nav"><div class="container-fluid"><div class="row"><div class="col-lg-12"><div class="action-menu pull-left clearfix"><a href="#menu-toggle" id="menu-toggle"><i class="fa fa-bars" aria-hidden="true"></i></a></div><ul class="pull-right"></ul></div></div></div></div><div id="content" data-github-owner="jgogstad" data-github-repo="fs2-blobstore"><div class="content-wrapper"><section><h1 id="sftp">SFTP</h1>

<p>This store is used to interface with SFTP servers. It’s built on <a href="http://www.jcraft.com/jsch/">JSch</a> and abstracts a lot of quirks in addition to providing a pure functional interface.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">blobstore.sftp.SftpStore</span>
<span class="k">import</span> <span class="nn">cats.ApplicativeThrow</span>
<span class="k">import</span> <span class="nn">cats.effect.</span><span class="o">{</span><span class="nc">Async</span><span class="o">,</span> <span class="nc">Resource</span><span class="o">}</span>
<span class="k">import</span> <span class="nn">cats.syntax.all._</span>
<span class="k">import</span> <span class="nn">com.jcraft.jsch.JSch</span>

<span class="k">import</span> <span class="nn">java.util.Properties</span>

<span class="k">def</span> <span class="nf">createStore</span><span class="o">[</span><span class="kt">F</span><span class="o">[</span><span class="k">_</span><span class="o">]</span><span class="kt">:</span> <span class="kt">Async</span><span class="o">]</span><span class="k">:</span> <span class="kt">Resource</span><span class="o">[</span><span class="kt">F</span>, <span class="kt">SftpStore</span><span class="o">[</span><span class="kt">F</span><span class="o">]]</span> <span class="k">=</span> <span class="o">{</span>
  <span class="k">val</span> <span class="nv">createSession</span> <span class="k">=</span> <span class="nc">ApplicativeThrow</span><span class="o">[</span><span class="kt">F</span><span class="o">].</span><span class="py">catchNonFatal</span><span class="o">(</span><span class="k">new</span> <span class="nc">JSch</span><span class="o">().</span><span class="py">getSession</span><span class="o">(</span><span class="s">"username"</span><span class="o">,</span> <span class="s">"host"</span><span class="o">)).</span><span class="py">map</span> <span class="o">{</span> <span class="n">session</span> <span class="k">=&gt;</span>
    <span class="nv">session</span><span class="o">.</span><span class="py">setTimeout</span><span class="o">(</span><span class="mi">10000</span><span class="o">)</span>
    <span class="nv">session</span><span class="o">.</span><span class="py">setPassword</span><span class="o">(</span><span class="s">"password"</span><span class="o">)</span>
 
    <span class="k">val</span> <span class="nv">config</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Properties</span>
    <span class="nv">config</span><span class="o">.</span><span class="py">put</span><span class="o">(</span><span class="s">"StrictHostKeyChecking"</span><span class="o">,</span> <span class="s">"no"</span><span class="o">)</span>
    <span class="nv">session</span><span class="o">.</span><span class="py">setConfig</span><span class="o">(</span><span class="n">config</span><span class="o">)</span>
    <span class="n">session</span> <span class="c1">// Let the store connect this session</span>
  <span class="o">}</span>
  
  <span class="nc">SftpStore</span><span class="o">[</span><span class="kt">F</span><span class="o">](</span><span class="n">createSession</span><span class="o">)</span>
<span class="o">}</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">SftpStore</code> creates a connection pool for JSch’s <a href="https://epaul.github.io/jsch-documentation/javadoc/com/jcraft/jsch/ChannelSftp.html"><code class="language-plaintext highlighter-rouge">ChannelSftp</code></a>, this is exposed as a <code class="language-plaintext highlighter-rouge">Resource[F, SftpStore[F]]</code>. You can control the size of this connection pool through the <code class="language-plaintext highlighter-rouge">SftpStore</code> constructor.</p>

<h2 id="absolute--and-rootless-paths">Absolute- and rootless paths</h2>

<p>Our <code class="language-plaintext highlighter-rouge">Path[A]</code> implementation is a co-product of <code class="language-plaintext highlighter-rouge">AbsolutePath[A]</code> and <code class="language-plaintext highlighter-rouge">RootlessPath[A]</code>,  the path constructor will do the right thing given a <code class="language-plaintext highlighter-rouge">String</code>:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">blobstore.url.Path</span>
<span class="k">import</span> <span class="nn">blobstore.url.Path.</span><span class="o">{</span><span class="nc">AbsolutePath</span><span class="o">,</span> <span class="nc">RootlessPath</span><span class="o">}</span>

<span class="nc">Path</span><span class="o">(</span><span class="s">"/foo/bar"</span><span class="o">)</span> <span class="o">==</span> <span class="nv">AbsolutePath</span><span class="o">.</span><span class="py">createFrom</span><span class="o">(</span><span class="s">"/foo/bar"</span><span class="o">)</span>
<span class="c1">// res0: Boolean = true</span>
<span class="nc">Path</span><span class="o">(</span><span class="s">"foo/bar"</span><span class="o">)</span> <span class="o">==</span> <span class="nv">RootlessPath</span><span class="o">.</span><span class="py">createFrom</span><span class="o">(</span><span class="s">"foo/bar"</span><span class="o">)</span>
<span class="c1">// res1: Boolean = true</span>
</code></pre></div></div>

<p>JSch uses SSH as the secure channel, and the semantics of relative paths is defined by SSH. Depending on how the SFTP server is configured, upon login you will either land in <code class="language-plaintext highlighter-rouge">/</code> (if the server uses chroot) or <code class="language-plaintext highlighter-rouge">/home/username/</code> (or anywhere else).</p>

<p>Rootless paths such as <code class="language-plaintext highlighter-rouge">foo/bar.txt</code> are always relative to your home directory under SSH. We don’t expose any APIs for changing the current working directory, so <code class="language-plaintext highlighter-rouge">./foo/bar.txt</code> and <code class="language-plaintext highlighter-rouge">foo/bar.txt</code> will always refer to the same object. In general, sticking to rootless paths is a good idea as you never risk to refer to anything outside the login directory.</p>
</section></div></div></div></div><script src="/fs2-blobstore/highlight/highlight.pack.js"></script><script>
// For all code blocks, copy the language from the containing div
// to the inner code tag (where hljs expects it to be)
const langPrefix = 'language-';
document.querySelectorAll(`div[class^='${langPrefix}']`).forEach(function(div) {
  div.classList.forEach(function(cssClass) {
    if (cssClass.startsWith(langPrefix)) {
      const lang = cssClass.substring(langPrefix.length);
      div.querySelectorAll('pre code').forEach(function(code) {
        code.classList.add(lang);
      });
    }
  });
});

hljs.configure({languages:['scala','java','bash']});
hljs.initHighlightingOnLoad();
      </script><script>console.info('\x57\x65\x62\x73\x69\x74\x65\x20\x62\x75\x69\x6c\x74\x20\x77\x69\x74\x68\x3a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x5f\x5f\x20\x20\x20\x20\x5f\x5f\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x5f\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x5f\x20\x5f\x5f\x0a\x20\x20\x20\x5f\x5f\x5f\x5f\x5f\x2f\x20\x2f\x5f\x20\x20\x2f\x20\x2f\x5f\x20\x20\x20\x20\x20\x20\x5f\x5f\x5f\x5f\x20\x5f\x5f\x5f\x20\x20\x28\x5f\x29\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x20\x20\x5f\x5f\x5f\x5f\x5f\x28\x5f\x29\x20\x2f\x5f\x5f\x5f\x5f\x20\x20\x5f\x5f\x5f\x5f\x5f\x0a\x20\x20\x2f\x20\x5f\x5f\x5f\x2f\x20\x5f\x5f\x20\x5c\x2f\x20\x5f\x5f\x2f\x5f\x5f\x5f\x5f\x5f\x2f\x20\x5f\x5f\x20\x60\x5f\x5f\x20\x5c\x2f\x20\x2f\x20\x5f\x5f\x5f\x2f\x20\x5f\x5f\x5f\x2f\x20\x5f\x5f\x20\x5c\x2f\x20\x5f\x5f\x5f\x2f\x20\x2f\x20\x5f\x5f\x2f\x20\x5f\x20\x5c\x2f\x20\x5f\x5f\x5f\x2f\x0a\x20\x28\x5f\x5f\x20\x20\x29\x20\x2f\x5f\x2f\x20\x2f\x20\x2f\x5f\x2f\x5f\x5f\x5f\x5f\x5f\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x5f\x5f\x2f\x20\x2f\x20\x20\x2f\x20\x2f\x5f\x2f\x20\x28\x5f\x5f\x20\x20\x29\x20\x2f\x20\x2f\x5f\x2f\x20\x20\x5f\x5f\x28\x5f\x5f\x20\x20\x29\x0a\x2f\x5f\x5f\x5f\x5f\x2f\x5f\x2e\x5f\x5f\x5f\x2f\x5c\x5f\x5f\x2f\x20\x20\x20\x20\x20\x2f\x5f\x2f\x20\x2f\x5f\x2f\x20\x2f\x5f\x2f\x5f\x2f\x5c\x5f\x5f\x5f\x2f\x5f\x2f\x20\x20\x20\x5c\x5f\x5f\x5f\x5f\x2f\x5f\x5f\x5f\x5f\x2f\x5f\x2f\x5c\x5f\x5f\x2f\x5c\x5f\x5f\x5f\x2f\x5f\x5f\x5f\x5f\x2f\x0a\x0a\x68\x74\x74\x70\x73\x3a\x2f\x2f\x34\x37\x64\x65\x67\x2e\x67\x69\x74\x68\x75\x62\x2e\x69\x6f\x2f\x73\x62\x74\x2d\x6d\x69\x63\x72\x6f\x73\x69\x74\x65\x73')</script><script src="/fs2-blobstore/js/search.js"></script><script src="/fs2-blobstore/js/docs.js"></script></body></html>